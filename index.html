<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Hypertext Heart — Vanishing Signal</title>
<style>
:root{
  --ink:#f2f2f2;
  --rose:#ff4da6;
  --rose-soft:#ff80c0;
  --aqua:#80ffea;
  --bg0:#000;
}
html,body{height:100%; margin:0;}
body{
  background: var(--bg0);
  color:var(--ink); font-family:"Georgia", serif;
  line-height:1.9; padding:8% 18%; font-size:1.25rem;
  overflow:hidden; transition: background .5s ease;
}

/* subtle color-only pulse for words */
.pulse-word{
  color:var(--rose);
  text-shadow:0 0 4px var(--rose);
  animation: heartbeat-color 1s infinite alternate;
}
@keyframes heartbeat-color{
  0%{ color: var(--rose); text-shadow:0 0 4px var(--rose);}
  50%{ color: #ff80c0; text-shadow:0 0 12px #ff80c0;}
  100%{ color: var(--rose); text-shadow:0 0 4px var(--rose);}
}

/* poem container */
#poem{transition: opacity .5s ease;}
.hidden{opacity:0;}

/* clickable words */
.link{color:var(--rose); text-decoration:none; cursor:pointer; position:relative; transition:color .25s, text-shadow .25s; white-space:nowrap;}
.link:hover{color:var(--rose-soft); text-shadow:0 0 12px var(--rose);}

/* hover reveal */
.alt{position:relative;}
.alt::after{
  content:attr(data-alt);
  position:absolute;
  left:50%; bottom:110%;
  transform: translateX(-50%) translateY(-6px);
  font-size:.9rem; color:#ffb6c1;
  opacity:0;
  pointer-events:none;
  white-space:nowrap;
  text-shadow:0 0 2px #fff;
  transition: opacity .2s, transform .2s;
}
.alt:hover::after{
  opacity:1;
  transform: translateX(-50%) translateY(-2px);
}

/* glitch */
.glitch{ position:relative; display:inline-block;}
.glitch::before,.glitch::after{ content:attr(data-text); position:absolute; left:0; top:0; opacity:.55;}
.glitch::before{ color:var(--rose); animation:gt 2.2s infinite alternate ease-in-out;}
.glitch::after{ color:var(--aqua); animation:gb 3.1s infinite alternate ease-in-out;}
@keyframes gt{0%{transform:translate(0,0)}12%{transform:translate(-2px,-1px)}25%{transform:translate(0,0)}37%{transform:translate(1px,-2px)}100%{transform:translate(0,0)}}
@keyframes gb{0%{transform:translate(0,0)}18%{transform:translate(2px,1px)}31%{transform:translate(0,0)}46%{transform:translate(-1px,2px)}100%{transform:translate(0,0)}}

/* crack overlay */
.crack{position:fixed; inset:0; pointer-events:none; background:repeating-linear-gradient(to bottom, rgba(255,255,255,.04) 0 1px, transparent 1px 3px), radial-gradient(1px 1px at 20% 30%, rgba(255,255,255,.12), transparent 70%), radial-gradient(1px 1px at 70% 60%, rgba(255,255,255,.12), transparent 70%); opacity:0; transition: opacity .3s ease;}
.crack.on{opacity:.45;}

.center{text-align:center; margin-top:18vh; color:#aaa;}
.center .big{font-size:1.6rem;}
.muted{color:#777;}
.count{font-variant-numeric:tabular-nums; font-size:2rem; letter-spacing:.04em;}
.sep{opacity:.5;}

/* broken 404 styling */
.broken404{
  color:#555;
  text-shadow:0 0 0 #000;
  animation:none;
  font-family:monospace;
  letter-spacing:0.06em;
  line-height:1.3;
}
.broken404 .glitch::before,
.broken404 .glitch::after{
  content: attr(data-text);
  position: absolute;
  left:0; top:0;
  opacity:0.3;
  color:#444;
  animation:none;
  text-shadow:none;
}
.broken404 .muted{color:#666; font-style:italic;}
</style>
</head>
<body>
<div class="crack" id="crack"></div>
<div id="poem">
I love you <span class="link alt pulse-word" data-alt="where silence leans into your breath" onclick="nextPage('here')">here</span>.
</div>

<audio id="beat" preload="auto" loop>
  <source src="heartbeat.mp3" type="audio/mpeg">
</audio>
<audio id="stat" preload="auto" loop>
  <source src="static.mp3" type="audio/mpeg">
</audio>

<script>
// Pages
const PAGES = {
"here":`I love you here—<span class="alt pulse-word" data-alt="attention cradled in light">where</span>
<span class="link alt pulse-word" data-alt="sound that carries memory" onclick="nextPage('echo')">echo</span>
wears the mask of <span class="link alt pulse-word" data-alt="a promise stitched in pixels" onclick="nextPage('permanence')">permanence</span>.`,
"echo":`You said <span class="glitch pulse-word" data-text="forever">forever</span>,
what reached me was not your voice but its
<span class="link alt pulse-word" data-alt="reverberation through the hollows" onclick="nextPage('decay')">reverb</span>.`,
"permanence":`Permanence is a museum label pinned to air.
Stones flake. Servers fail. Even vows become
<span class="link alt pulse-word" data-alt="soft dust, fading with time" onclick="nextPage('decay')">dust</span>.`,
"decay":`What remains is a hyperlink that <span class="glitch pulse-word" data-text="already broke">already broke</span>,
a name eroded to <span class="alt pulse-word" data-alt="tiny fragments of memory">pixels</span>.
If you still want an ending, try to <span class="link alt pulse-word" data-alt="treading softly over lost signals" onclick="nextPage('end')">continue</span>.`,
"end":`<div class="center broken404">
  <div class="big glitch" data-text="404: love not found">404: love not found</div>
</div>`,
"gone":`<div class="center broken404">
  <div class="big">410: gone</div>
  <div class="muted">neglect writes the last line<br class="sep"/>refresh will not restore what attention forgot</div>
</div>`
};

const poemEl = document.getElementById('poem');
const crackEl = document.getElementById('crack');
const beat = document.getElementById('beat');
const stat = document.getElementById('stat');

let idleMs = 0, hidden = false, hardIdleMs = 0;
let audioInitialized = false;

// Audio volumes
beat.volume = 0;
stat.volume = 0;

// Smooth fade function
function fadeAudio(audio, target, duration) {
    const startVolume = audio.volume;
    const step = (target - startVolume) / (duration / 50);
    const interval = setInterval(() => {
        audio.volume = Math.max(0, Math.min(1, audio.volume + step));
        if ((step > 0 && audio.volume >= target) || (step < 0 && audio.volume <= target)) {
            audio.volume = target;
            clearInterval(interval);
        }
    }, 50);
}

// Initialize audio on first user interaction
function initAudio() {
    if (audioInitialized) return;
    audioInitialized = true;
    
    // Start both sounds
    beat.play().catch(() => {});
    stat.play().catch(() => {});
    
    // Start with heartbeat
    playHeartbeat();
}

// Play heartbeat (when text is visible)
function playHeartbeat() {
    fadeAudio(beat, 0.4, 500);
    fadeAudio(stat, 0, 300);
}

// Fade to static (when text is hidden)
function fadeToStatic() {
    fadeAudio(beat, 0, 500);
    fadeAudio(stat, 0.15, 500);
}

// Check localStorage if secret ending already shown
let secretDone = false;
try {
    secretDone = localStorage.getItem('secretEndingShown') === 'true';
} catch (e) {
    // localStorage might not be available
    secretDone = false;
}

const HIDE_AFTER = 700, DEAD_AFTER = 10000; // 10 seconds

// Display next page
function nextPage(key) {
    if (!audioInitialized) initAudio();
    
    poemEl.classList.add('hidden');
    setTimeout(() => {
        poemEl.innerHTML = PAGES[key];
        poemEl.classList.remove('hidden');
    }, 150);
}

// Mouse movement
function onMove() {
    if (!audioInitialized) initAudio();
    
    idleMs = 0;
    hardIdleMs = 0;
    
    if (hidden) {
        poemEl.classList.remove('hidden');
        hidden = false;
        playHeartbeat(); // Resume heartbeat when text becomes visible
    }
}

document.addEventListener('mousemove', onMove);
document.addEventListener('touchmove', onMove, { passive: true });
document.addEventListener('click', initAudio, { once: true });
document.addEventListener('touchstart', initAudio, { once: true });
document.addEventListener('keydown', initAudio, { once: true });

// Idle loop
function tick() {
    idleMs += 200;
    hardIdleMs += 200;
    
    if (idleMs > HIDE_AFTER && !hidden) {
        poemEl.classList.add('hidden');
        hidden = true;
        fadeToStatic(); // Switch to static when text disappears
    }
    
    if (hardIdleMs >= DEAD_AFTER && !secretDone) {
        secretEnding();
        secretDone = true;
        try {
            localStorage.setItem('secretEndingShown', 'true');
        } catch (e) {
            // localStorage might not be available
        }
        return;
    }
    
    setTimeout(tick, 200);
}
tick();

// Secret ending
function secretEnding() {
    document.body.style.pointerEvents = 'none';
    poemEl.classList.add('hidden');
    fadeToStatic(); // Switch to static for the secret ending
    setTimeout(() => {
        poemEl.innerHTML = PAGES.gone;
        poemEl.classList.remove('hidden');
    }, 150);
}
</script>
</body>
</html>
